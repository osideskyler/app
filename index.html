<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusFlow - Prototype</title>
    <style>
        /* --- Basic Reset & Globals --- */
        :root {
            --bg-color: #f4f7fc;
            --primary-color: #6a11cb; /* Deep purple */
            --secondary-color: #2575fc; /* Vibrant blue */
            --accent-color: #34e89e; /* Bright green for progress/completion */
            --text-color: #333;
            --text-light: #f9f9f9;
            --border-color: #e0e0e0;
            --card-bg: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --gradient-main: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 16px; /* Base font size */
        }

        /* --- Layout & Structure --- */
        .container {
            display: flex;
            flex-grow: 1;
        }

        header {
            background: var(--gradient-main);
            color: var(--text-light);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 1.8em;
            margin: 0;
        }

        .gamification-status {
            font-weight: bold;
        }
        .gamification-status #points-display{
             background-color: var(--accent-color);
             padding: 5px 10px;
             border-radius: 15px;
             color: var(--text-color);
             margin-left: 5px;
        }


        nav#sidebar {
            width: 220px;
            background-color: var(--card-bg);
            padding: 1.5rem 1rem;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            border-right: 1px solid var(--border-color);
        }

        nav#sidebar ul {
            list-style: none;
        }

        nav#sidebar li a {
            display: block;
            padding: 0.8rem 1rem;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            font-weight: 500;
        }

        nav#sidebar li a:hover,
        nav#sidebar li a.active {
            background-color: var(--secondary-color);
            color: var(--text-light);
        }


        main#content {
            flex-grow: 1;
            padding: 2rem;
            overflow-y: auto; /* Allow scrolling if content overflows */
        }

        /* --- View Specific Styles --- */
        .view {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-in-out;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* --- Form & Input Styles --- */
        .input-group {
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .input-group input[type="text"],
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .input-group select {
            appearance: none; /* Remove default dropdown arrow */
            background-color: #fff; /* Ensure background is white */
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007bff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); /* Custom arrow */
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
             padding-right: 2.5em; /* Make space for arrow */
        }


        .btn {
            background: var(--secondary-color);
            color: var(--text-light);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-weight: bold;
            font-size: 1rem;
            display: inline-block; /* Ensure buttons align well */
            margin-right: 0.5rem; /* Space between buttons */
        }

         .btn:last-child {
            margin-right: 0;
         }

        .btn:hover {
            background-color: var(--primary-color);
        }

        .btn-delete {
            background-color: #e74c3c;
            font-size: 0.8em;
            padding: 0.2rem 0.5rem;
            margin-left: 10px;
            opacity: 0.7;
        }
        .btn-delete:hover {
            opacity: 1;
            background-color: #c0392b;
        }

        /* --- List Styles --- */
        .goal-list, .task-list, .inbox-list {
            list-style: none;
            margin-top: 1.5rem;
        }

        .goal-list li, .task-list li, .inbox-list li {
            background: var(--card-bg);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease-in-out;
        }

        .goal-list li:hover, .task-list li:hover, .inbox-list li:hover{
             transform: translateY(-2px);
             box-shadow: 0 6px 12px rgba(0,0,0,0.12);
        }


        /* Hierarchy Indentation */
        .goal-list .monthly-goal { margin-left: 20px; border-left-color: var(--secondary-color); }
        .goal-list .weekly-goal { margin-left: 40px; border-left-color: var(--accent-color); }
        .task-list .daily-task { margin-left: 60px; border-left-color: #f39c12; } /* Orange for tasks */


        .task-list input[type="checkbox"] {
            margin-right: 1rem;
            transform: scale(1.2); /* Make checkbox slightly bigger */
            cursor: pointer;
        }

        .task-list .task-content {
           flex-grow: 1;
        }


        .task-list .completed .task-content {
            text-decoration: line-through;
            color: #aaa;
            font-style: italic;
        }

        .task-list .completed {
            border-left-color: #bdc3c7; /* Grey out completed task border */
            opacity: 0.7;
        }

        /* --- Specific View Details --- */
        #goals-view h3 {
            margin-top: 1.5rem;
             color: var(--primary-color);
             border-bottom: 2px solid var(--border-color);
             padding-bottom: 0.3rem;
        }
         #goals-view h3:first-of-type {
            margin-top: 0;
         }

        /* Simple Calendar Placeholder */
        #calendar-view p {
            font-style: italic;
            color: #777;
            padding: 2rem;
            text-align: center;
            background-color: var(--card-bg);
             border-radius: 8px;
             box-shadow: var(--shadow);
        }

        /* Tooltip (for item IDs, perhaps later) */
        /* [data-tooltip]:hover::after { ... } */

        /* --- Footer (Optional) --- */
        footer {
             text-align: center;
             padding: 1rem;
             margin-top: 2rem; /* Pushes footer down */
             color: #777;
             font-size: 0.9em;
             border-top: 1px solid var(--border-color);
        }

         /* --- Responsive (Very Basic) --- */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            nav#sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                display: flex; /* Basic horizontal nav on mobile */
                justify-content: space-around;
                 padding: 0.5rem 0;
            }
            nav#sidebar ul {
                display: flex;
                 width: 100%;
                 justify-content: space-around;
            }
             nav#sidebar li a {
                 padding: 0.5rem;
                 margin-bottom: 0;
                 text-align: center;
             }

            header {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
            }
            header h1 { font-size: 1.5em; margin-bottom: 0.5rem;}
             main#content {
                 padding: 1rem;
             }
            .input-group {
                padding: 1rem;
            }
             .goal-list .monthly-goal { margin-left: 10px; }
             .goal-list .weekly-goal { margin-left: 20px; }
             .task-list .daily-task { margin-left: 30px; }

             .btn { padding: 0.6rem 1rem; font-size: 0.9rem;}
        }


    </style>
</head>
<body>

    <header>
        <h1>NexusFlow</h1>
        <div class="gamification-status">
            Points: <span id="points-display">0</span>
        </div>
    </header>

    <div class="container">
        <nav id="sidebar">
            <ul>
                <li><a href="#" class="nav-link active" data-view="goals-view">Goals & Tasks</a></li>
                <li><a href="#" class="nav-link" data-view="inbox-view">Inbox</a></li>
                <li><a href="#" class="nav-link" data-view="today-focus-view">Today's Focus</a></li>
                <li><a href="#" class="nav-link" data-view="calendar-view">Calendar</a></li>
            </ul>
        </nav>

        <main id="content">
            <!-- Goals & Tasks View -->
            <section id="goals-view" class="view active">
                <h2>Goals & Tasks</h2>

                <!-- Add Goal/Task Form -->
                <div class="input-group">
                    <form id="add-item-form">
                         <label for="item-type">Type:</label>
                         <select id="item-type" name="item-type" required>
                              <option value="yearly">Yearly Goal</option>
                              <option value="monthly">Monthly Goal</option>
                              <option value="weekly">Weekly Goal</option>
                              <option value="daily">Daily Task</option>
                         </select>

                         <label for="item-parent">Parent Goal (Optional):</label>
                         <select id="item-parent" name="item-parent">
                              <option value="">-- Select Parent (if applicable) --</option>
                              <!-- Options populated by JS -->
                         </select>

                         <label for="item-title">Title:</label>
                         <input type="text" id="item-title" name="item-title" placeholder="Enter goal or task title" required>

                         <button type="submit" class="btn">Add Item</button>
                    </form>
                </div>

                <!-- Goals Display Area -->
                <h3>Yearly Goals</h3>
                <ul id="yearly-goals" class="goal-list">
                    <!-- Populated by JS -->
                </ul>
                <!-- Nested lists for Monthly, Weekly, Daily will be inside yearly goals -->

            </section>

            <!-- Inbox View -->
            <section id="inbox-view" class="view">
                <h2>GTD Inbox</h2>
                <p>Capture everything here. Process later.</p>

                 <div class="input-group">
                     <form id="add-inbox-form">
                          <label for="inbox-item-text">Capture Idea/Task:</label>
                          <input type="text" id="inbox-item-text" name="inbox-item-text" placeholder="Quick capture..." required>
                          <button type="submit" class="btn">Add to Inbox</button>
                     </form>
                 </div>

                <ul id="inbox-list" class="inbox-list">
                    <!-- Populated by JS -->
                </ul>
            </section>

            <!-- Today's Focus View -->
            <section id="today-focus-view" class="view">
                <h2>Today's Focus</h2>
                <p>Actionable tasks for today.</p>
                <ul id="today-tasks-list" class="task-list">
                    <!-- Populated by JS (simplified: shows all incomplete daily tasks) -->
                </ul>
            </section>

            <!-- Calendar View -->
            <section id="calendar-view" class="view">
                <h2>Calendar</h2>
                 <p>Full calendar integration is a feature for a more advanced version. This view would show tasks scheduled on specific dates.</p>
                 <!-- Placeholder for future calendar integration -->
            </section>

        </main>
    </div>

    <footer>
        NexusFlow Prototype - Connect your actions, achieve your vision. (Simplified Demo)
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Globals ---
            const goalsView = document.getElementById('goals-view');
            const inboxView = document.getElementById('inbox-view');
            const todayFocusView = document.getElementById('today-focus-view');
            const calendarView = document.getElementById('calendar-view');
            const views = document.querySelectorAll('.view');
            const navLinks = document.querySelectorAll('.nav-link');

            const addItemForm = document.getElementById('add-item-form');
            const itemTypeSelect = document.getElementById('item-type');
            const itemParentSelect = document.getElementById('item-parent');
            const itemTitleInput = document.getElementById('item-title');
            const yearlyGoalsList = document.getElementById('yearly-goals'); // Main container

            const addInboxForm = document.getElementById('add-inbox-form');
            const inboxItemInput = document.getElementById('inbox-item-text');
            const inboxList = document.getElementById('inbox-list');

            const todayTasksList = document.getElementById('today-tasks-list');
            const pointsDisplay = document.getElementById('points-display');

            // --- Data Structure ---
            let data = {
                goals: [], // { id, type: 'yearly'/'monthly'/'weekly', title, children: [], parentId: null }
                tasks: [], // { id, type: 'daily', title, completed: false, parentId: null (linked to a goal) }
                inbox: [], // { id, text }
                gamification: {
                    points: 0
                }
            };

            // --- Utility Functions ---
            const generateId = () => `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

            const saveData = () => {
                localStorage.setItem('nexusFlowData', JSON.stringify(data));
            };

            const loadData = () => {
                const savedData = localStorage.getItem('nexusFlowData');
                if (savedData) {
                    data = JSON.parse(savedData);
                }
                 // Ensure basic structure exists if loading older data
                data.goals = data.goals || [];
                data.tasks = data.tasks || [];
                data.inbox = data.inbox || [];
                data.gamification = data.gamification || { points: 0 };
                data.gamification.points = data.gamification.points || 0;
            };

            // --- Rendering Functions ---

             // Renders Goals and Tasks Hierarchically
            const renderGoalsAndTasks = () => {
                yearlyGoalsList.innerHTML = ''; // Clear current list

                const createGoalElement = (item, levelClass = '') => {
                    const li = document.createElement('li');
                    li.classList.add(`${item.type}-goal`, levelClass); // e.g., yearly-goal
                    li.dataset.id = item.id;

                    li.innerHTML = `
                        <span class="goal-title">${item.title}</span>
                        <button class="btn btn-delete">Delete</button>
                    `;

                     // Create a sub-list for children goals/tasks
                     const childrenList = document.createElement('ul');
                     childrenList.classList.add('goal-list', 'task-list'); // Nested lists
                     li.appendChild(childrenList); // Append even if empty, easier later

                     // Recursively render children goals
                     (item.children || []).forEach(childId => {
                        const childGoal = data.goals.find(g => g.id === childId);
                        if (childGoal) {
                             const childEl = createGoalElement(childGoal, `${childGoal.type}-goal`);
                             childrenList.appendChild(childEl);
                        }
                     });

                     // Render associated tasks (Daily)
                      const relatedTasks = data.tasks.filter(t => t.parentId === item.id);
                      relatedTasks.forEach(task => {
                          const taskEl = createTaskElement(task, 'daily-task');
                          childrenList.appendChild(taskEl);
                      });


                    // Add delete listener
                    li.querySelector('.btn-delete').addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent triggering clicks on parent elements
                        deleteItem(item.id, item.type);
                    });

                    return li;
                };

                const createTaskElement = (task, levelClass = 'daily-task') => {
                     const li = document.createElement('li');
                    li.classList.add(levelClass);
                    li.dataset.id = task.id;
                    if (task.completed) {
                        li.classList.add('completed');
                    }

                    li.innerHTML = `
                        <input type="checkbox" ${task.completed ? 'checked' : ''}>
                        <span class="task-content">${task.title}</span>
                        <button class="btn btn-delete">Delete</button>
                    `;

                    // Add complete toggle listener
                     li.querySelector('input[type="checkbox"]').addEventListener('change', (e) => {
                        toggleTaskComplete(task.id);
                     });

                    // Add delete listener
                    li.querySelector('.btn-delete').addEventListener('click', (e) => {
                         e.stopPropagation();
                         deleteItem(task.id, 'daily');
                     });

                    return li;
                 };


                // Start rendering from top-level (yearly) goals
                const yearlyGoals = data.goals.filter(g => g.type === 'yearly');
                yearlyGoals.forEach(goal => {
                    yearlyGoalsList.appendChild(createGoalElement(goal));
                });

                // Update parent dropdown
                updateParentSelect();
                // Also render today's focus view when goals change
                renderTodayFocus();
            };

            const renderInbox = () => {
                inboxList.innerHTML = '';
                data.inbox.forEach(item => {
                    const li = document.createElement('li');
                    li.dataset.id = item.id;
                    li.innerHTML = `
                        <span>${item.text}</span>
                        <div>
                             <!-- Add 'Process' button maybe later -->
                             <button class="btn btn-delete">Delete</button>
                         </div>
                    `;
                     li.querySelector('.btn-delete').addEventListener('click', () => {
                        deleteItem(item.id, 'inbox');
                     });
                    inboxList.appendChild(li);
                });
            };

            const renderTodayFocus = () => {
                todayTasksList.innerHTML = '';
                // Simplified: Show all incomplete daily tasks
                const incompleteTasks = data.tasks.filter(task => task.type === 'daily' && !task.completed);

                if(incompleteTasks.length === 0) {
                    todayTasksList.innerHTML = '<li>No pressing tasks right now. Great job or add some!</li>';
                    return;
                }

                incompleteTasks.forEach(task => {
                     const li = document.createElement('li');
                    li.classList.add('daily-task'); // Keep consistent styling
                    li.dataset.id = task.id;
                    li.innerHTML = `
                        <input type="checkbox">
                        <span class="task-content">${task.title}</span>
                        <button class="btn btn-delete">Delete</button>
                    `;
                    // Add listeners
                     li.querySelector('input[type="checkbox"]').addEventListener('change', () => toggleTaskComplete(task.id));
                    li.querySelector('.btn-delete').addEventListener('click', () => deleteItem(task.id, 'daily'));

                    todayTasksList.appendChild(li);
                });
            };


             const updateParentSelect = () => {
                itemParentSelect.innerHTML = '<option value="">-- Select Parent (if applicable) --</option>'; // Reset

                 const populateOptions = (goals, prefix = '') => {
                     goals.forEach(goal => {
                         const option = document.createElement('option');
                         option.value = goal.id;
                         option.textContent = `${prefix}${goal.title} (${goal.type})`;
                         itemParentSelect.appendChild(option);

                         // Recursively add children, indenting title
                         const children = data.goals.filter(g => g.parentId === goal.id);
                          if(children.length > 0) {
                             populateOptions(children, prefix + '    '); // Indent sub-goals
                         }
                     });
                 };

                 // Populate only with potential parents (Yearly, Monthly, Weekly goals)
                 const potentialParents = data.goals.filter(g => ['yearly', 'monthly', 'weekly'].includes(g.type));
                 // Filter to only top-level ones to start recursion correctly
                 populateOptions(potentialParents.filter(g => !g.parentId));
             };

            const updatePointsDisplay = () => {
                pointsDisplay.textContent = data.gamification.points;
                 // Add a little flash effect on update
                 pointsDisplay.style.transition = 'none';
                 pointsDisplay.style.transform = 'scale(1.3)';
                 pointsDisplay.style.backgroundColor = '#fff'; // Flash white
                 setTimeout(() => {
                     pointsDisplay.style.transition = 'transform 0.2s ease, background-color 0.2s ease';
                     pointsDisplay.style.transform = 'scale(1)';
                      pointsDisplay.style.backgroundColor = 'var(--accent-color)'; // Back to original
                 }, 50);
            };

             // --- Event Handlers ---
            const handleAddItemSubmit = (e) => {
                e.preventDefault();
                const type = itemTypeSelect.value;
                const title = itemTitleInput.value.trim();
                const parentId = itemParentSelect.value || null; // Ensure null if empty

                if (!title) return; // Basic validation

                const newItem = {
                    id: generateId(),
                    type: type,
                    title: title,
                    parentId: parentId // Track parentage
                };

                if (type === 'daily') {
                     // Validate parent exists if selected, and is not another daily task
                    if(parentId) {
                        const parentGoal = data.goals.find(g => g.id === parentId);
                        if (!parentGoal || parentGoal.type === 'daily') {
                             alert("Daily tasks should be linked to a Yearly, Monthly, or Weekly goal.");
                             return;
                         }
                     } else {
                         alert("Daily tasks should ideally be linked to a parent goal.");
                         // Could allow unlinked, but discourage it for NexusFlow philosophy
                         // return;
                     }
                    newItem.completed = false;
                    data.tasks.push(newItem);
                } else {
                     // Validate parent exists and hierarchy makes sense
                    if (parentId) {
                         const parentGoal = data.goals.find(g => g.id === parentId);
                         const hierarchy = { 'monthly': 'yearly', 'weekly': 'monthly' };
                         if (!parentGoal || parentGoal.type !== hierarchy[type]) {
                             alert(`A ${type} goal should be linked to a ${hierarchy[type]} goal.`);
                             return;
                         }
                         // Add to parent's children array
                         parentGoal.children = parentGoal.children || [];
                         parentGoal.children.push(newItem.id);

                     } else if (type !== 'yearly') {
                        alert(`${type} goals should be linked to a parent goal.`);
                         // Allow unlinked? Maybe depends on strictness
                         // return;
                     }
                    newItem.children = []; // Goals can have children
                    data.goals.push(newItem);
                }

                saveData();
                renderGoalsAndTasks(); // Re-render the whole goal tree
                itemTitleInput.value = ''; // Clear input
                 itemParentSelect.value = ''; // Reset parent selection
            };

            const handleAddInboxSubmit = (e) => {
                e.preventDefault();
                const text = inboxItemInput.value.trim();
                if (!text) return;

                const newItem = { id: generateId(), text: text };
                data.inbox.push(newItem);

                saveData();
                renderInbox();
                inboxItemInput.value = '';
            };

            const toggleTaskComplete = (taskId) => {
                 const task = data.tasks.find(t => t.id === taskId);
                 if (!task) return;

                 task.completed = !task.completed;

                 // Gamification: Add points for completing, remove if uncompleting
                 if (task.completed) {
                     data.gamification.points += 10; // Example points
                     // Add celebration?
                 } else {
                     data.gamification.points -= 10;
                     if (data.gamification.points < 0) data.gamification.points = 0;
                 }

                 saveData();
                 renderGoalsAndTasks(); // Re-render needed to update class visually
                 renderTodayFocus(); // Also update Today view
                 updatePointsDisplay();
            };


             // Recursive delete helper
            const deleteGoalAndChildren = (goalId) => {
                 const goalIndex = data.goals.findIndex(g => g.id === goalId);
                 if (goalIndex === -1) return;

                 const goal = data.goals[goalIndex];

                 // 1. Delete all associated tasks
                 data.tasks = data.tasks.filter(task => task.parentId !== goalId);

                 // 2. Recursively delete all children goals
                 if (goal.children && goal.children.length > 0) {
                    // Iterate over a copy because the recursive call might modify the array
                    [...goal.children].forEach(childId => {
                        deleteGoalAndChildren(childId); // Recursive call
                    });
                }

                // 3. Remove this goal from its parent's children array (if it has a parent)
                if(goal.parentId) {
                    const parentGoal = data.goals.find(g => g.id === goal.parentId);
                    if(parentGoal && parentGoal.children) {
                        parentGoal.children = parentGoal.children.filter(id => id !== goalId);
                    }
                }


                 // 4. Delete the goal itself
                 data.goals.splice(goalIndex, 1);
             };


            const deleteItem = (itemId, itemType) => {
                if (!confirm('Are you sure you want to delete this item and any potential sub-items?')) {
                    return;
                }

                if (itemType === 'inbox') {
                    data.inbox = data.inbox.filter(item => item.id !== itemId);
                } else if (itemType === 'daily') {
                    data.tasks = data.tasks.filter(task => task.id !== itemId);
                     // Maybe deduct points if deleting an incomplete task? Optional rule.
                } else if (['yearly', 'monthly', 'weekly'].includes(itemType)) {
                     deleteGoalAndChildren(itemId); // Use the recursive function
                 }


                saveData();
                // Re-render appropriate views
                if (itemType === 'inbox') renderInbox();
                else {
                    renderGoalsAndTasks(); // Goal/task deletion affects the main tree and Today view
                    renderTodayFocus();
                }
                updateParentSelect(); // Parent might have been deleted
                // updatePointsDisplay(); // If points logic is added for deletion
            };


             // --- Navigation ---
            const showView = (viewId) => {
                views.forEach(view => {
                    view.classList.remove('active');
                });
                document.getElementById(viewId).classList.add('active');

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.view === viewId) {
                        link.classList.add('active');
                    }
                });
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showView(e.target.dataset.view);
                });
            });

            // --- Initialization ---
            loadData();
            renderGoalsAndTasks(); // Initial render
            renderInbox();
            updatePointsDisplay();
            showView('goals-view'); // Start on goals view

            // Attach form listeners
            addItemForm.addEventListener('submit', handleAddItemSubmit);
            addInboxForm.addEventListener('submit', handleAddInboxSubmit);

             // Log initial data for debugging
             console.log("NexusFlow Initialized. Data:", data);

        }); // End DOMContentLoaded
    </script>

</body>
</html>
